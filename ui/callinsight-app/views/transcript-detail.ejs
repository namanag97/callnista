<%- include('partials/header', { title: 'Transcript: ' + call.id }) %>

<div class="page-header">
    <div class="page-title">
        <h1>Call Transcript: <%= call.id %></h1>
        <div class="page-subtitle"><%= call.category %> | <%= call.date %> <%= call.time %></div>
    </div>
    
    <div class="action-buttons">
        <button class="btn btn-secondary">
            <svg data-feather="edit-2"></svg>
            <span>Edit</span>
        </button>
        <button class="btn btn-secondary">
            <svg data-feather="download"></svg>
            <span>Export</span>
        </button>
        <a href="/transcripts" class="btn btn-primary">
            <svg data-feather="arrow-left"></svg>
            <span>Back to List</span>
        </a>
    </div>
</div>

<div class="chat-container">
    <!-- Recordings List Panel -->
    <div class="recordings-panel">
        <div class="content-card" style="height: 100%;">
            <div class="content-card-header">
                <div class="content-card-title">Call Recordings</div>
                <div style="display: flex; align-items: center;">
                    <button class="btn btn-icon btn-secondary" style="padding: 0.25rem; margin-right: 0.25rem;">
                        <svg data-feather="filter" width="14" height="14"></svg>
                    </button>
                    <button class="btn btn-icon btn-secondary" style="padding: 0.25rem;">
                        <svg data-feather="search" width="14" height="14"></svg>
                    </button>
                </div>
            </div>
            
            <div class="recordings-list">
                <div class="recording-item <%= call.id === 'CALL-2023-0451' ? 'active' : '' %>">
                    <div class="recording-title">CALL-2023-0451</div>
                    <div style="font-size: 0.75rem; color: var(--gray-600); margin-bottom: 0.25rem;">Transactions > Failed Transfer</div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--gray-500);">
                        <span>Aug 21, 2023</span>
                        <span>15:18</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; align-items: center;">
                        <span class="badge badge-info">Escalated</span>
                        <span style="font-size: 0.75rem; color: var(--gray-500);">Priya Patel</span>
                    </div>
                </div>
                
                <div class="recording-item <%= call.id === 'CALL-2023-0450' ? 'active' : '' %>">
                    <div class="recording-title">CALL-2023-0450</div>
                    <div style="font-size: 0.75rem; color: var(--gray-600); margin-bottom: 0.25rem;">Product Info > Investment Plans</div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--gray-500);">
                        <span>Aug 21, 2023</span>
                        <span>04:37</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; align-items: center;">
                        <span class="badge badge-success">Resolved</span>
                        <span style="font-size: 0.75rem; color: var(--gray-500);">Amit Kumar</span>
                    </div>
                </div>
                
                <div class="recording-item <%= call.id === 'CALL-2023-0449' ? 'active' : '' %>">
                    <div class="recording-title">CALL-2023-0449</div>
                    <div style="font-size: 0.75rem; color: var(--gray-600); margin-bottom: 0.25rem;">Customer Service > Complaint</div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--gray-500);">
                        <span>Aug 21, 2023</span>
                        <span>12:45</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; align-items: center;">
                        <span class="badge badge-warning">Workaround</span>
                        <span style="font-size: 0.75rem; color: var(--gray-500);">Sneha Gupta</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chat Panel -->
    <div class="content-card" style="flex: 1;">
        <div class="content-card-header">
            <div class="content-card-title">
                <div>Call Transcript: <%= call.id %></div>
                <div style="font-size: 0.75rem; color: var(--gray-500);"><%= call.category %> | <%= call.date %> <%= call.time %></div>
            </div>
            
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                    <svg data-feather="edit-2" width="14" height="14"></svg>
                    <span>Edit</span>
                </button>
                <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                    <svg data-feather="download" width="14" height="14"></svg>
                    <span>Export</span>
                </button>
            </div>
        </div>
        
        <div class="content-card-body" style="padding: 0;">
            <!-- Audio player -->
            <div style="padding: 1rem; border-bottom: 1px solid var(--gray-200); background-color: var(--gray-50);">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <button class="player-control" style="background-color: white; border: 1px solid var(--gray-300); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0;">
                        <svg data-feather="play" width="16" height="16"></svg>
                    </button>
                    <div style="flex: 1;">
                        <div class="timeline" style="width: 100%; height: 4px; background-color: var(--gray-300); border-radius: 9999px; position: relative;">
                            <div class="timeline-progress" style="position: absolute; left: 0; top: 0; height: 100%; background-color: var(--primary); border-radius: 9999px; width: 35%;"></div>
                            <div class="timeline-handle" style="width: 12px; height: 12px; background-color: var(--primary); border-radius: 50%; position: absolute; top: 50%; transform: translate(-50%, -50%); cursor: pointer; left: 35%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem;">
                            <span>05:21 / <%= call.duration %></span>
                            <div style="display: flex; gap: 0.5rem;">
                                <svg data-feather="volume-1" width="14" height="14" style="color: var(--gray-500);"></svg>
                                <svg data-feather="fast-forward" width="14" height="14" style="color: var(--gray-500);"></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat messages -->
            <div style="padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; max-height: calc(100vh - 14rem); background-color: var(--gray-50);">
                <div style="display: flex; max-width: 80%; align-self: flex-start;">
                    <div style="width: 36px; height: 36px; border-radius: 9999px; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 0.75rem; flex-shrink: 0;">A</div>
                    <div style="background-color: white; padding: 0.75rem 1rem; border-radius: var(--radius-lg); font-size: 0.875rem; box-shadow: var(--shadow-sm); position: relative; border: 1px solid var(--gray-200);">
                        <div style="margin-bottom: 0.25rem; font-weight: 500; font-size: 0.75rem; color: var(--primary-dark);">Agent (<%= call.agent.split(' ')[0] %>)</div>
                        Thank you for calling ABC Financial Services. My name is <%= call.agent.split(' ')[0] %>. How may I help you today?
                        <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">00:07</div>
                    </div>
                </div>
                
                <div style="display: flex; max-width: 80%; align-self: flex-end; flex-direction: row-reverse;">
                    <div style="width: 36px; height: 36px; border-radius: 9999px; background-color: var(--secondary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-left: 0.75rem; flex-shrink: 0;">C</div>
                    <div style="background-color: var(--primary-light); padding: 0.75rem 1rem; border-radius: var(--radius-lg); font-size: 0.875rem; box-shadow: var(--shadow-sm); position: relative; color: var(--primary-dark); border: 1px solid var(--primary-light);">
                        <div style="margin-bottom: 0.25rem; font-weight: 500; font-size: 0.75rem; color: var(--gray-700);">Customer</div>
                        <% if (call.id === 'CALL-2023-0451') { %>
                            Hi, I've been trying to transfer money to my son's account but the transaction keeps failing. I've tried three times already and each time I get an error message.
                        <% } else if (call.id === 'CALL-2023-0450') { %>
                            Hello, I'd like some information about your investment plans. I'm looking to invest for my retirement.
                        <% } else { %>
                            Hi, I'm calling about an issue with your service. I've been experiencing delays and it's causing me problems.
                        <% } %>
                        <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">00:22</div>
                    </div>
                </div>
                
                <div style="display: flex; max-width: 80%; align-self: flex-start;">
                    <div style="width: 36px; height: 36px; border-radius: 9999px; background-color: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 0.75rem; flex-shrink: 0;">A</div>
                    <div style="background-color: white; padding: 0.75rem 1rem; border-radius: var(--radius-lg); font-size: 0.875rem; box-shadow: var(--shadow-sm); position: relative; border: 1px solid var(--gray-200);">
                        <div style="margin-bottom: 0.25rem; font-weight: 500; font-size: 0.75rem; color: var(--primary-dark);">Agent (<%= call.agent.split(' ')[0] %>)</div>
                        <% if (call.id === 'CALL-2023-0451') { %>
                            I'm sorry to hear that you're experiencing issues with your transfer. I'd be happy to help you resolve this. Could you please verify your account by providing your customer ID?
                        <% } else if (call.id === 'CALL-2023-0450') { %>
                            Thank you for your interest in our investment plans. I'd be glad to provide you with information about our retirement options. First, could you please verify your identity with your customer ID?
                        <% } else { %>
                            I apologize for the inconvenience you've been experiencing. I'll do my best to address your concerns. May I have your customer ID to verify your account?
                        <% } %>
                        <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">00:38</div>
                    </div>
                </div>
                
                <div style="text-align: center; padding: 1rem; font-size: 0.75rem; color: var(--gray-500);">
                    <span>Showing 3 of 24 messages</span>
                    <div style="margin-top: 0.5rem;">
                        <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                            <span>Load More</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="padding: 1rem; border-top: 1px solid var(--gray-200);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <div style="font-size: 0.875rem; font-weight: 500;">Transcript Confidence: 
                        <span style="color: var(--success);">High (96%)</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-icon btn-secondary">
                            <svg data-feather="flag" width="14" height="14"></svg>
                        </button>
                        <button class="btn btn-icon btn-secondary">
                            <svg data-feather="thumbs-up" width="14" height="14"></svg>
                        </button>
                    </div>
                </div>
                
                <div style="font-size: 0.75rem; color: var(--gray-500);">
                    <span>Transcription by ElevenLabs API | Analysis by OpenAI GPT-4</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Analysis Panel -->
    <div class="content-card" style="width: 320px; flex-shrink: 0;">
        <div class="content-card-header">
            <div class="content-card-title">Call Analysis</div>
        </div>
        <div class="content-card-body" style="padding: 0;">
            <div style="padding: 1rem; border-bottom: 1px solid var(--gray-200);">
                <div style="font-weight: 500; font-size: 0.875rem; margin-bottom: 0.75rem;">Call Information</div>
                
                <div style="margin-bottom: 0.5rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Agent</div>
                    <div style="font-size: 0.875rem;"><%= call.agent %></div>
                </div>
                
                <div style="margin-bottom: 0.5rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Customer ID</div>
                    <div style="font-size: 0.875rem;">CUST00584</div>
                </div>
                
                <div style="margin-bottom: 0.5rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Date & Time</div>
                    <div style="font-size: 0.875rem;"><%= call.date %> <%= call.time %></div>
                </div>
                
                <div style="margin-bottom: 0.5rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Duration</div>
                    <div style="font-size: 0.875rem;"><%= call.duration %></div>
                </div>
                
                <div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Status</div>
                    <div>
                        <% if (call.status === 'Resolved') { %>
                            <span class="badge badge-success">Resolved</span>
                        <% } else if (call.status === 'Escalated') { %>
                            <span class="badge badge-info">Escalated</span>
                        <% } else if (call.status === 'Workaround') { %>
                            <span class="badge badge-warning">Workaround</span>
                        <% } else { %>
                            <span class="badge badge-danger">Unresolved</span>
                        <% } %>
                    </div>
                </div>
            </div>
            
            <div style="padding: 1rem; border-bottom: 1px solid var(--gray-200);">
                <div style="font-weight: 500; font-size: 0.875rem; margin-bottom: 0.75rem;">AI Analysis</div>
                
                <div style="margin-bottom: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Issue Category</div>
                    <div style="font-size: 0.875rem;"><%= call.category %></div>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Severity</div>
                    <div>
                        <% if (call.severity === 'Critical') { %>
                            <span class="badge badge-danger">Critical</span>
                        <% } else if (call.severity === 'Medium') { %>
                            <span class="badge badge-warning">Medium</span>
                        <% } else { %>
                            <span class="badge badge-info">Low</span>
                        <% } %>
                    </div>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Customer Sentiment</div>
                    <div style="font-size: 0.875rem;">
                        <% if (call.id === 'CALL-2023-0451') { %>
                            Started Negative, Ended Neutral
                        <% } else if (call.id === 'CALL-2023-0450') { %>
                            Positive
                        <% } else { %>
                            Started Negative, Ended Negative
                        <% } %>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <div style="font-size: 0.75rem; color: var(--danger);">Negative</div>
                        <div style="flex: 1; height: 8px; background: linear-gradient(to right, var(--danger), var(--gray-300), var(--success)); border-radius: 9999px; margin: 0 0.5rem; position: relative;">
                            <% let markerPosition = call.id === 'CALL-2023-0451' ? '65%' : call.id === 'CALL-2023-0450' ? '85%' : '30%'; %>
                            <div style="position: absolute; width: 12px; height: 12px; background-color: white; border: 2px solid var(--gray-700); border-radius: 50%; top: 50%; transform: translate(-50%, -50%); left: <%= markerPosition %>;"></div>
                        </div>
                        <div style="font-size: 0.75rem; color: var(--success);">Positive</div>
                    </div>
                </div>
                
                <div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Extracted Entities</div>
                    <div style="font-size: 0.875rem; border-top: 1px solid var(--gray-200);">
                        <% if (call.id === 'CALL-2023-0451') { %>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Error Code</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">E-45632</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Transfer Amount</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">Rs. 45,000</div>
                            </div>
                        <% } else if (call.id === 'CALL-2023-0450') { %>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Investment Type</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">Retirement</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Interest</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">Long Term</div>
                            </div>
                        <% } else { %>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Issue Type</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">Service Delay</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                                <div style="font-size: 0.75rem; color: var(--gray-600);">Priority</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">High</div>
                            </div>
                        <% } %>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                            <div style="font-size: 0.75rem; color: var(--gray-600);">Customer ID</div>
                            <div style="font-size: 0.75rem; font-weight: 500;">CUST00584</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="padding: 1rem;">
                <div style="font-weight: 500; font-size: 0.875rem; margin-bottom: 0.75rem;">Analysis Verification</div>
                
                <div style="font-size: 0.875rem; margin-bottom: 0.75rem;">
                    Is the AI analysis accurate and complete?
                </div>
                
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <button class="btn btn-secondary" style="flex: 1; font-size: 0.75rem; padding: 0.375rem 0.75rem;">
                        <svg data-feather="thumbs-up" width="14" height="14"></svg>
                        <span>Accurate</span>
                    </button>
                    <button class="btn btn-secondary" style="flex: 1; font-size: 0.75rem; padding: 0.375rem 0.75rem;">
                        <svg data-feather="edit-2" width="14" height="14"></svg>
                        <span>Edit</span>
                    </button>
                </div>
                
                <div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.25rem;">Comments (optional)</div>
                    <textarea style="width: 100%; min-height: 80px; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: var(--radius); font-family: inherit; font-size: 0.75rem;" placeholder="Add your verification notes here..."></textarea>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="uploadModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Upload Call Recordings</div>
            <button class="modal-close" id="closeModal">
                <svg data-feather="x"></svg>
            </button>
        </div>
        <div class="modal-body">
            <form action="/uploads" method="post" enctype="multipart/form-data">
                <div class="upload-area" id="dropArea">
                    <div class="upload-icon">
                        <svg data-feather="upload-cloud" width="48" height="48"></svg>
                    </div>
                    <div class="upload-text">
                        <strong>Click to upload</strong> or drag and drop
                    </div>
                    <div class="upload-hint">
                        Supports AAC, MP3, and WAV audio files (Max: 50MB)
                    </div>
                    <input type="file" id="fileInput" name="audioFiles" style="display: none;" multiple accept=".aac,.mp3,.wav">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Processing Queue</label>
                    <select class="form-control" name="processingQueue">
                        <option value="standard">Standard Queue (Processing time: ~30 mins)</option>
                        <option value="priority">Priority Queue (Processing time: ~10 mins)</option>
                        <option value="batch">Batch Processing (Schedule for off-peak hours)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tags (Optional)</label>
                    <input type="text" class="form-control" name="tags" placeholder="E.g., product-inquiry, escalation, hindi">
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelUpload">Cancel</button>
                    <button type="submit" class="btn btn-primary">Start Upload</button>
                </div>
            </form>
        </div>
    </div>
</div>

<%- include('partials/footer') %>